% MSTREAM - Calculates the overturning streamfunction%%  M. den Toom%% SYNTAX%%  PSIG = msteam(v,varx,varz)%% DESCRIPTION%%  Calculates the overturning streamfunction from v, by integrating over%  longitude, using the bounding coordinates in varx (now a 2D array),%  and subsequently integrating over depth, using the bounding coordinates%  in varz.%function PSIG = mstream(v,varx,varz)%fprintf(1,'Overturning streamfunction...\n')%% - ERROR CHECK -if (ndims(v)~=3)    error('The v field must be three dimensional')elseif (ndims(varx)~=2)    error('The bounding longitude coordinate must be two dimensional')elseif (size(v,1)~=size(varx,1)-1)    error('The longtitude coordinate does not match the v field')elseif (size(v,2)~=size(varx,2))    error('The size of the longitude coordinate does not match the u field')elseif (size(v,3)~=length(varz)-1)    error('The depth coordinate does not match the u field')end%% - INTEGRATION -for j = 1:size(varx,2)    for i = 1:size(varx,1)-1        v(i,j,:)  = v(i,j,:)*(varx(i+1,j)-varx(i,j));    endendVINT  = squeeze(sum(v,1));for k = 1:length(varz)-1    VINT(:,k) = VINT(:,k)*(varz(k+1)-varz(k));endPSIG  = -cumsum(VINT,2)/1.e6;PSIG  = [zeros(1,size(PSIG,2)); PSIG];